<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choir Player</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/7.0.0/wavesurfer.min.js"></script>
</head>
<body>
  <h1>Choir Player</h1>
  <div id="tracks"></div>

  <script>
    // Fetch the track configuration
    fetch('tracks.json')
      .then(response => response.json())
      .then(data => initPlayer(data));

// JavaScript Code with requested changes

      function initPlayer(tracks) {
        const container = document.getElementById('tracks');
        const howls = [];
        const waveforms = [];
      
        // Create UI and initialize Howler and WaveSurfer for each track
        tracks.forEach((track, index) => {
          // Create Howl instance
          const howl = new Howl({
            src: [track.file],
            loop: true,
            volume: 1.0
          });
          howls.push(howl);
      
          // Create a waveform container
          const waveformContainer = document.createElement('div');
          waveformContainer.id = `waveform-${index}`;
          waveformContainer.style.width = '100%';
          waveformContainer.style.overflowX = 'scroll';
          waveformContainer.style.border = '1px solid #ccc';
          waveformContainer.style.marginTop = '10px';
      
          // Create track UI
          const trackDiv = document.createElement('div');
          trackDiv.classList.add('track');
          trackDiv.innerHTML = `
            <strong>${track.title}</strong>
            <input data-track="${track.title}" type="range" class="volume" min="0" max="1" step="0.1" value="1">
          `;
          trackDiv.appendChild(waveformContainer);
          container.appendChild(trackDiv);
      
          // Initialize WaveSurfer
          const waveform = WaveSurfer.create({
            container: `#waveform-${index}`,
            waveColor: '#ddd',
            progressColor: '#225588',
            responsive: true,
            height: 50,
            scrollParent: true // Enable scrolling for waveforms
          });
          waveform.load(track.file);
          waveforms.push(waveform);
      
          // Synchronize seeking across all tracks
          waveform.on('seek', (progress) => {
            const seekTime = progress * howl.duration();
            howls.forEach(h => h.seek(seekTime));
            waveforms.forEach(w => w.seekTo(progress));
          });
        });
      
        // Create global Play/Pause button
        const playPauseButton = document.createElement('button');
        playPauseButton.textContent = 'Play';
        playPauseButton.style.marginBottom = '20px';
        playPauseButton.addEventListener('click', () => {
          const isPlaying = howls.some(h => h.playing());
          if (isPlaying) {
            howls.forEach(h => h.pause());
            playPauseButton.textContent = 'Play';
          } else {
            howls.forEach(h => h.play());
            playPauseButton.textContent = 'Pause';
          }
        });
        container.prepend(playPauseButton);
      
        // Volume controls
        container.addEventListener('input', (e) => {
          if (e.target.classList.contains('volume')) {
            const trackName = e.target.dataset.track;
            const index = tracks.findIndex(t => t.title === trackName);
            if (index !== -1) {
              howls[index].volume(parseFloat(e.target.value));
            }
          }
        });
      }
  </script>
</body>
</html>
